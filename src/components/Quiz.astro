---
interface Question {
  q: string;
  options: string[];
  correct: number;
  explain: string;
}

interface Props {
  questions: Question[];
}

const { questions } = Astro.props;
---

<div class="quiz-container">
  {questions.map((question, idx) => (
    <div class="quiz-question" data-question-id={idx}>
      <h4>Question {idx + 1}: {question.q}</h4>
      <div class="quiz-options">
        {question.options.map((option, optIdx) => (
          <button 
            class="option-btn" 
            data-question={idx}
            data-option={optIdx}
            data-correct={question.correct}
          >
            {option}
          </button>
        ))}
      </div>
      <div class="result" data-result={idx} style="display: none;">
        <p class="result-message"></p>
        <p class="result-explanation">{question.explain}</p>
      </div>
    </div>
  ))}
</div>

<style>
  .quiz-container {
    background: #fff5f5;
    border-left: 4px solid var(--isu-red);
    padding: 20px;
    border-radius: 8px;
    margin: 30px 0;
  }

  .quiz-question {
    margin-bottom: 30px;
  }

  .quiz-question:last-child {
    margin-bottom: 0;
  }

  .quiz-question h4 {
    color: var(--isu-red);
    margin-bottom: 15px;
    font-weight: 500;
  }

  .quiz-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .option-btn {
    padding: 12px 16px;
    border: 2px solid #ddd;
    background: white;
    color: var(--text-dark);
    text-align: left;
    border-radius: 6px;
    cursor: pointer;
    transition: 0.2s;
    font-weight: 500;
    font-size: 1em;
  }

  .option-btn:hover {
    border-color: var(--isu-red);
    background: #fff5f5;
  }

  .option-btn.correct {
    background: #d4f4dd;
    border-color: #2ecc71;
  }

  .option-btn.incorrect {
    background: #f8d7da;
    border-color: #dc3545;
  }

  .option-btn:disabled {
    cursor: not-allowed;
  }

  .result {
    margin-top: 15px;
    padding: 15px;
    border-radius: 6px;
  }

  .result.correct {
    background: #d4f4dd;
    color: #155724;
    border-left: 4px solid #2ecc71;
  }

  .result.incorrect {
    background: #f8d7da;
    color: #721c24;
    border-left: 4px solid #dc3545;
  }

  .result-message {
    font-weight: 600;
    margin-bottom: 10px;
  }

  .result-explanation {
    font-weight: 400;
    font-size: 0.95em;
    margin: 0;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const optionButtons = document.querySelectorAll('.option-btn');
    
    optionButtons.forEach(btn => {
      btn.addEventListener('click', (e) => {
        const target = e.target as HTMLButtonElement;
        const questionId = target.dataset.question;
        const selectedOption = parseInt(target.dataset.option || '0');
        const correctOption = parseInt(target.dataset.correct || '0');
        
        // Get all buttons for this question
        const allButtons = document.querySelectorAll(`[data-question="${questionId}"]`);
        
        // Disable all buttons
        allButtons.forEach(button => {
          (button as HTMLButtonElement).disabled = true;
        });
        
        // Mark selected button
        const isCorrect = selectedOption === correctOption;
        target.classList.add(isCorrect ? 'correct' : 'incorrect');
        
        // Show result
        const result = document.querySelector(`[data-result="${questionId}"]`) as HTMLElement;
        const message = result.querySelector('.result-message');
        
        if (result && message) {
          result.style.display = 'block';
          result.classList.add(isCorrect ? 'correct' : 'incorrect');
          message.textContent = isCorrect ? '✓ Correct!' : '✗ Incorrect';
        }
      });
    });
  });
</script>